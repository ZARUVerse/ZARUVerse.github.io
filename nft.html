<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ZARUverse | Your NFT Relics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b0c" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #0b0b0c;
      color: #e8e8e8;
      text-align: center;
      padding: 40px 20px;
    }
    h1 {
      font-size: 32px;
      font-weight: 900;
      color: #ffd700;
      margin-bottom: 20px;
    }
    .btn {
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      background: #ffd700;
      color: #0b0b0c;
      font-weight: 700;
      cursor: pointer;
      margin: 6px;
      text-decoration: none;
      display: inline-block;
    }
    .nft-card {
      margin-bottom: 40px;
      padding: 20px;
      background: #111;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(255,215,0,0.2);
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .nft-card img {
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(255,215,0,0.4);
    }
    .lore {
      margin-top: 20px;
      font-size: 14px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h1>üõ°Ô∏è Your Arxium NFTs</h1>
<p id="walletStatus">Connect your wallet to view your relics.</p>
<button class="btn" onclick="connectWallet()">üîó Connect Wallet</button>
<button class="btn" onclick="disconnectWallet()">‚õì Disconnect</button>

<div id="nftList" style="margin-top:40px;"></div>

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.12/dist/index.js"></script>

<script>
  const CONTRACT_ADDRESS = "0x57664ea40e95636ed7a4df35f4b31e3656a851cd"; // Arxium NFT
  const IPFS_LORE = "https://ipfs.io/ipfs/bafkreias7mdy6vti7xopxdrpaikwmpnrxjubcjojdzk2pwqksvstzf2bty";

  const ABI = [
    { constant: true, inputs: [{ name: "owner", type: "address" }], name: "balanceOf", outputs: [{ name: "", type: "uint256" }], type: "function" },
    { constant: true, inputs: [{ name: "tokenId", type: "uint256" }], name: "tokenURI", outputs: [{ name: "", type: "string" }], type: "function" },
    { constant: true, inputs: [{ name: "owner", type: "address" }, { name: "index", type: "uint256" }], name: "tokenOfOwnerByIndex", outputs: [{ name: "", type: "uint256" }], type: "function" },
    { constant: false, inputs: [{ name: "tokenId", type: "uint256" }], name: "burn", outputs: [], type: "function" }
  ];

  let web3Modal, provider, web3, userAddress;

  async function connectWallet() {
    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider,
        options: { rpc: { 56: "https://bsc-dataseed.binance.org/" }, chainId: 56 }
      }
    };

    web3Modal = new window.Web3Modal.default({ cacheProvider: false, providerOptions });

    try {
      provider = await web3Modal.connect();
      web3 = new Web3(provider);
      const accounts = await web3.eth.getAccounts();
      userAddress = accounts[0];
      document.getElementById("walletStatus").innerText = `‚úÖ Connected: ${short(userAddress)}`;
      await checkNFTs();
    } catch (err) {
      document.getElementById("walletStatus").innerText = "‚ùå Wallet connection failed.";
    }
  }

  function short(addr) {
    return addr ? addr.slice(0,6) + "..." + addr.slice(-4) : "";
  }

  async function disconnectWallet() {
    try {
      if (provider && provider.disconnect) await provider.disconnect();
    } catch(e) {}
    provider = undefined;
    web3 = undefined;
    userAddress = undefined;
    document.getElementById("walletStatus").innerText = "üîå Disconnected.";
    document.getElementById("nftList").innerHTML = "";
  }

  async function checkNFTs() {
    const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
    const balance = await contract.methods.balanceOf(userAddress).call();
    const container = document.getElementById("nftList");
    container.innerHTML = "";

    if (Number(balance) === 0) {
      container.innerHTML = "<p>üö´ No Arxium NFTs detected.</p>";
      return;
    }

    for (let i = 0; i < balance; i++) {
      try {
        const tokenId = await contract.methods.tokenOfOwnerByIndex(userAddress, i).call();
        const uri = await contract.methods.tokenURI(tokenId).call();
        const metadata = await fetch(uri).then(res => res.json());

        const card = document.createElement("div");
        card.className = "nft-card";
        card.innerHTML = `
          <h3>üõ°Ô∏è Arxium #${tokenId}</h3>
          <img src="${metadata.image}" alt="Arxium NFT" />
          <p>${metadata.name || "Unnamed Relic"}</p>
          <div style="margin-top:20px;">
            <a href="dao.html" class="btn">‚öñÔ∏è DAO</a>
            <a href="staking.html" class="btn">‚öîÔ∏è Stake</a>
            <a href="vault.html" class="btn">üîê Vault</a>
            <a href="mint.html" class="btn">üéÅ Claim</a>
            <button class="btn" onclick="fetchLore(${tokenId})">üìú Lore</button>
            <button class="btn" onclick="claimReward(${tokenId})">üí∞ Reward</button>
            <button class="btn" onclick="burnNFT(${tokenId})">üî• Burn</button>
          </div>
          <div id="lore-${tokenId}" class="lore"></div>
        `;
        container.appendChild(card);
      } catch (err) {
        console.error(`Failed to load NFT #${i}`, err);
      }
    }
  }

  async function fetchLore(tokenId) {
    try {
      const res = await fetch(IPFS_LORE, { cache: "no-store" });
      if (!res.ok) throw new Error("IPFS fetch failed");
      const text = await res.text();
      typeLore(text, tokenId);
    } catch (err) {
      document.getElementById(`lore-${tokenId}`).innerText = "‚ö†Ô∏è Failed to load lore.";
    }
  }

  function typeLore(text, tokenId) {
    const out = document.getElementById(`lore-${tokenId}`);
    out.innerHTML = "";
    let i = 0;
    const speed = 26;
    const timer = setInterval(() => {
      out.innerHTML += text[i] || "";
      i++;
      if (i >= text.length) clearInterval(timer);
    }, speed);
  }

  async function claimReward(tokenId) {
    alert(`üí∞ Reward claimed for Arxium #${tokenId} (stub function).`);
    // Replace with actual staking contract interaction if needed
  }

  async function burnNFT(tokenId) {
    if (!confirm(`Are you sure you want to burn Arxium #${tokenId}? This action is irreversible.`)) return;
    try {
      const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
      await contract.methods.burn(tokenId).
            await contract.methods.burn(tokenId).send({ from: userAddress });
      alert(`üî• Arxium #${tokenId} burned successfully.`);
      await checkNFTs(); // Refresh list
    } catch (err) {
      alert("‚ùå Burn failed. You must be the owner.");
      console.error(err);
    }
  }
</script>

</body>
</html>

