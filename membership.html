<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZARUverse Membership</title>

  <!-- ÿ™ŸÖ ŸÖÿ±⁄©ÿ≤€å ÿßÿ≤ template.html -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles/template.css" /> <!-- ÿß⁄Øÿ± ÿ™ŸÖ ÿ¨ÿØÿß ÿØÿßÿ±€å -->

  <!-- reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Lem-scrAAAAAGjL94fUCVEtFUUlQGh_MEQ343uJ"></script>

  <!-- Web3Modal -->
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@latest/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@latest/dist/index.js"></script>
</head>

<body>
  <header>
    <!-- ŸÜÿßŸàÿ®ÿ±€å ŸÖÿ±⁄©ÿ≤€å ÿßÿ≤ template.html -->
  </header>

  <main>
    <div id="formcarry-section" style="display:none;">
      <section class="formcarry-container">
        <form id="zaru-form">
          <div class="formcarry-block">
            <label for="name">Full Name</label>
            <input type="text" name="name" id="name" required />
          </div>

          <div class="formcarry-block">
            <label for="email">Email Address</label>
            <input type="email" name="email" id="email" required />
          </div>

          <div class="formcarry-block">
            <label for="wallet">Wallet Address</label>
            <input type="text" name="wallet" id="wallet" readonly />
          </div>

          <div class="formcarry-block">
            <label for="message">Message</label>
            <textarea name="message" id="message" placeholder="Enter your message..."></textarea>
          </div>

          <div class="formcarry-block">
            <button type="submit">Send</button>
          </div>
        </form>

        <div id="success-message" style="display:none; padding:20px; text-align:center;">
          ‚úÖ Your message has been received. Welcome to ZARUverse.
        </div>
      </section>
    </div>

    <div id="access-denied" style="display:none; text-align:center; padding:40px;">
      <h2>üö´ Access Denied</h2>
      <p>You must hold ZARU Token to access this form.</p>
      <a href="https://tofunft.com/collection/zaruverse" target="_blank">Mint ZARU Token</a>
    </div>
  </main>

  <footer>
    <!-- ŸÅŸàÿ™ÿ± ŸÖÿ±⁄©ÿ≤€å ÿßÿ≤ template.html -->
  </footer>

  <script>
    const zaruTokenAddress = "0xdac6f0ec5901b3877dc6db23c3882267ba9fabf6";
    const zaruTokenABI = [{
      "constant": true,
      "inputs": [{"name": "_owner", "type": "address"}],
      "name": "balanceOf",
      "outputs": [{"name": "balance", "type": "uint256"}],
      "type": "function"
    }];

    async function checkZaruAccess() {
      const providerOptions = {
        walletconnect: {
          package: window.WalletConnectProvider,
          options: {
            rpc: { 56: "https://bsc-dataseed.binance.org/" }
          }
        }
      };

      const web3Modal = new window.Web3Modal.default({ cacheProvider: false, providerOptions });
      const instance = await web3Modal.connect();
      const web3 = new Web3(instance);
      const accounts = await web3.eth.getAccounts();
      const userAddress = accounts[0];
      document.getElementById("wallet").value = userAddress;

      const tokenContract = new web3.eth.Contract(zaruTokenABI, zaruTokenAddress);
      const balance = await tokenContract.methods.balanceOf(userAddress).call();

      if (parseInt(balance) > 0) {
        document.getElementById("formcarry-section").style.display = "block";
      } else {
        document.getElementById("access-denied").style.display = "block";
      }
    }

    window.addEventListener("load", () => {
      checkZaruAccess();
    });

    document.getElementById("zaru-form").addEventListener("submit", function(e) {
      e.preventDefault();

      grecaptcha.ready(function() {
        grecaptcha.execute('6Lem-scrAAAAAGjL94fUCVEtFUUlQGh_MEQ343uJ', {action: 'submit'}).then(function(token) {
          const formData = new FormData(document.getElementById("zaru-form"));
          formData.append("g-recaptcha-response", token);

          fetch("https://formcarry.com/s/_g23_Fh7JC5", {
            method: "POST",
            body: formData
          })
          .then(response => {
            if (response.ok) {
              document.getElementById("zaru-form").style.display = "none";
              document.getElementById("success-message").style.display = "block";
            } else {
              alert("‚ùå Submission failed. Try again.");
            }
          })
          .catch(error => {
            console.error("Error:", error);
            alert("‚ùå Network error. Try again.");
          });
        });
      });
    });
  </script>
</body>
</html>
