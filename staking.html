<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ZARUverse | Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@latest/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@latest/dist/index.js"></script>
</head>

<body class="bg-dark text-light">
  <div class="container py-5">
    <h1 class="display-4 fw-bold text-center mb-4">‚öîÔ∏è Stake Your ZARU</h1>
    <p class="lead text-center mb-5">Lock your tokens. Earn your power. Unlock the encrypted realms.</p>

    <div class="text-center mb-4">
      <button class="btn btn-warning btn-lg" id="connectWallet">üîó Connect Wallet</button>
      <p id="walletAddress" class="mt-3"></p>
    </div>

    <div id="stakingArea" style="display:none;">
      <div class="mb-3">
        <label for="stakeAmount" class="form-label">Amount to stake:</label>
        <input type="number" id="stakeAmount" class="form-control" placeholder="Enter amount in ZARU" />
      </div>
      <div class="d-grid gap-2">
        <button class="btn btn-success" id="stakeBtn">‚öîÔ∏è Stake</button>
        <button class="btn btn-outline-light" id="unstakeBtn">üß© Unstake</button>
      </div>
      <p id="statusMsg" class="mt-4 text-center"></p>
    </div>
  </div>

  <script>
    const zaruTokenAddress = "0xdac6f0ec5901b3877dc6db23c3882267ba9fabf6";
    const zaruTokenABI = [
      {
        "inputs": [{"internalType": "uint256","name": "amount","type": "uint256"}],
        "name": "stake",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "unstake",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3;
    let userAddress;
    let zaruContract;

    async function connectWallet() {
      const providerOptions = {
        walletconnect: {
          package: window.WalletConnectProvider,
          options: {
            rpc: { 56: "https://bsc-dataseed.binance.org/" }
          }
        }
      };

      const web3Modal = new window.Web3Modal.default({ cacheProvider: false, providerOptions });
      const instance = await web3Modal.connect();
      web3 = new Web3(instance);
      const accounts = await web3.eth.getAccounts();
      userAddress = accounts[0];
      zaruContract = new web3.eth.Contract(zaruTokenABI, zaruTokenAddress);

      document.getElementById("walletAddress").innerText = `Connected: ${userAddress}`;
      document.getElementById("stakingArea").style.display = "block";
    }

    async function stakeTokens() {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount || amount <= 0) return alert("‚ùå Enter a valid amount");
      const amountWei = web3.utils.toWei(amount, "ether");
      document.getElementById("statusMsg").innerText = "‚è≥ Staking in progress...";
      try {
        await zaruContract.methods.stake(amountWei).send({ from: userAddress });
        document.getElementById("statusMsg").innerText = "‚úÖ Staked successfully!";
      } catch (err) {
        console.error(err);
        document.getElementById("statusMsg").innerText = "‚ùå Staking failed.";
      }
    }

    async function unstakeTokens() {
      document.getElementById("statusMsg").innerText = "‚è≥ Unstaking in progress...";
      try {
        await zaruContract.methods.unstake().send({ from: userAddress });
        document.getElementById("statusMsg").innerText = "‚úÖ Unstaked successfully!";
      } catch (err) {
        console.error(err);
        document.getElementById("statusMsg").innerText = "‚ùå Unstaking failed.";
      }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("stakeBtn").addEventListener("click", stakeTokens);
    document.getElementById("unstakeBtn").addEventListener("click", unstakeTokens);
  </script>
</body>
</html>
